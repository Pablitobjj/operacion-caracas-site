<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">

    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-CGEDD2Q5SL"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-CGEDD2Q5SL');
    </script>

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DELTA DAWN - Hall of Fame</title>
    <meta name="theme-color" content="#000000">
    
    <link rel="stylesheet" href="styles.css">
    
    <style>
        .hall-page {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 40px 20px;
        }
        
        .hall-header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .hall-header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .hall-header .subtitle {
            color: var(--primary-red);
            letter-spacing: 4px;
            font-size: 1rem;
        }
        
        .hall-container {
            width: 100%;
            max-width: 800px;
        }
        
        .hall-table-wrapper {
            background: var(--bg-dark);
            border: 3px solid var(--primary-red);
            padding: 20px;
            position: relative;
        }
        
        .hall-table-wrapper::before {
            content: '';
            position: absolute;
            top: -6px;
            left: -6px;
            right: -6px;
            bottom: -6px;
            border: 2px solid var(--secondary-yellow);
            pointer-events: none;
        }
        
        .hall-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .hall-table th {
            color: var(--secondary-yellow);
            text-transform: uppercase;
            letter-spacing: 2px;
            font-size: 0.85rem;
            padding: 15px 10px;
            border-bottom: 2px solid var(--primary-red);
            text-align: left;
        }
        
        .hall-table td {
            padding: 15px 10px;
            border-bottom: 1px solid #222;
            font-size: 1rem;
        }
        
        .hall-table tr:hover td {
            background: rgba(255, 0, 0, 0.1);
        }
        
        .hall-table .rank-col {
            width: 50px;
            text-align: center;
            color: var(--text-gray);
        }
        
        .hall-table .name-col {
            color: var(--text-white);
            letter-spacing: 2px;
        }
        
        .hall-table .grade-col {
            text-align: center;
        }
        
        .hall-table .score-col {
            text-align: right;
            color: var(--secondary-yellow);
            font-weight: bold;
        }
        
        .hall-table .time-col {
            text-align: right;
            color: var(--text-gray);
        }
        
        /* Rank badges */
        .grade {
            display: inline-block;
            padding: 3px 10px;
            font-weight: bold;
            letter-spacing: 1px;
            min-width: 40px;
        }
        
        .grade-s-plus { color: #FFD700; text-shadow: 0 0 10px #FFD700; }
        .grade-s { color: #FFD700; text-shadow: 0 0 8px #FFD700; }
        .grade-a { color: #00FF00; text-shadow: 0 0 8px #00FF00; }
        .grade-b { color: #00BFFF; text-shadow: 0 0 8px #00BFFF; }
        .grade-c { color: #FFFFFF; }
        .grade-d { color: #888888; }
        .grade-f { color: #FF0000; }
        
        /* Top 3 special styles */
        .hall-table tr:nth-child(1) .rank-col { color: #FFD700; font-size: 1.3rem; }
        .hall-table tr:nth-child(2) .rank-col { color: #C0C0C0; font-size: 1.2rem; }
        .hall-table tr:nth-child(3) .rank-col { color: #CD7F32; font-size: 1.1rem; }
        
        .hall-table tr:nth-child(1) .name-col { color: var(--secondary-yellow); }
        
        /* Empty state */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-gray);
        }
        
        .empty-state h3 {
            color: var(--primary-red);
            margin-bottom: 15px;
        }
        
        .empty-state p {
            margin-bottom: 30px;
        }
        
        /* Actions */
        .hall-actions {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
        }
        
        .hall-footer {
            margin-top: 40px;
            text-align: center;
            color: var(--text-gray);
            font-size: 0.8rem;
        }
        
        @media (max-width: 600px) {
            .hall-header h1 {
                font-size: 1.8rem;
            }
            
            .hall-table th,
            .hall-table td {
                padding: 10px 5px;
                font-size: 0.85rem;
            }
            
            .hall-table .time-col {
                display: none;
            }
        }
    </style>
</head>
<body>
    <main class="hall-page">
        <div class="hall-header">
            <h1 class="flicker">‚òÖ HALL OF HEROES ‚òÖ</h1>
            <div class="subtitle">TOP 10 OPERATIVOS</div>
        </div>
        
        <div class="hall-container">
            <div class="hall-table-wrapper">
                <!-- Tabla o empty state se renderiza con JS -->
                <div id="hall-content">
                    <p class="text-center text-gray">Cargando...</p>
                </div>
            </div>
            
            <div class="hall-actions">
                <a href="/play" class="btn btn-primary">JUGAR AHORA</a>
                <a href="/" class="btn btn-secondary">‚Üê MEN√ö</a>
            </div>
        </div>
        
        <div class="hall-footer">
            Los scores se guardan localmente en tu navegador.<br>
            Borra el cach√© para reiniciar el ranking.
        </div>
    </main>
    
    <script>
        const STORAGE_KEY = 'dd_oc_highscores_v1';
        
        // =====================================
        // LOAD AND RENDER HIGHSCORES
        // =====================================
        function loadHighscores() {
            try {
                const data = localStorage.getItem(STORAGE_KEY);
                if (!data) return [];
                
                const scores = JSON.parse(data);
                
                // Validar que sea un array
                if (!Array.isArray(scores)) return [];
                
                // Ordenar por score descendente
                return scores.sort((a, b) => b.score - a.score).slice(0, 10);
            } catch (e) {
                console.error('Error loading highscores:', e);
                return [];
            }
        }
        
        function getGradeClass(rank) {
            const rankLower = (rank || '').toLowerCase().replace('+', '-plus');
            return `grade-${rankLower}`;
        }
        
        function renderHighscores() {
            const container = document.getElementById('hall-content');
            const scores = loadHighscores();
            
            if (scores.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <h3>NO HAY REGISTROS</h3>
                        <p>S√© el primero en completar la misi√≥n y entrar al Hall of Heroes.</p>
                        <a href="/play" class="btn btn-primary">INICIAR MISI√ìN</a>
                    </div>
                `;
                return;
            }
            
            let tableHTML = `
                <table class="hall-table">
                    <thead>
                        <tr>
                            <th class="rank-col">#</th>
                            <th class="name-col">CALLSIGN</th>
                            <th class="grade-col">RANK</th>
                            <th class="score-col">SCORE</th>
                            <th class="time-col">TIEMPO</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            scores.forEach((entry, index) => {
                const position = index + 1;
                const positionSymbol = position <= 3 ? ['ü•á', 'ü•à', 'ü•â'][index] : position;
                const gradeClass = getGradeClass(entry.rank);
                
                tableHTML += `
                    <tr>
                        <td class="rank-col">${positionSymbol}</td>
                        <td class="name-col">${escapeHtml(entry.name || 'AAA')}</td>
                        <td class="grade-col">
                            <span class="grade ${gradeClass}">${escapeHtml(entry.rank || '-')}</span>
                        </td>
                        <td class="score-col">${(entry.score || 0).toLocaleString()}</td>
                        <td class="time-col">${escapeHtml(entry.time || '--:--')}</td>
                    </tr>
                `;
            });
            
            tableHTML += `
                    </tbody>
                </table>
            `;
            
            container.innerHTML = tableHTML;
        }
        
        // Escape HTML para prevenir XSS
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // =====================================
        // DEBUG: Agregar scores de prueba
        // =====================================
        window.addTestScores = function() {
            const testScores = [
                { name: 'ACE', rank: 'S+', score: 84250, time: '2:12' },
                { name: 'GHO', rank: 'S', score: 71800, time: '2:28' },
                { name: 'MAX', rank: 'S', score: 68400, time: '2:45' },
                { name: 'PRO', rank: 'A', score: 52500, time: '2:58' },
                { name: 'BOB', rank: 'A', score: 48200, time: '3:12' },
                { name: 'JOE', rank: 'B', score: 38900, time: '3:45' },
                { name: 'SAM', rank: 'B', score: 35100, time: '4:02' },
                { name: 'CAT', rank: 'C', score: 28400, time: '4:15' },
                { name: 'DOG', rank: 'C', score: 22100, time: '4:38' },
                { name: 'ZZZ', rank: 'D', score: 15800, time: '5:12' }
            ];
            
            localStorage.setItem(STORAGE_KEY, JSON.stringify(testScores));
            renderHighscores();
            console.log('Test scores added!');
        };
        
        window.clearScores = function() {
            localStorage.removeItem(STORAGE_KEY);
            renderHighscores();
            console.log('Scores cleared!');
        };
        
        // =====================================
        // INIT
        // =====================================
        document.addEventListener('DOMContentLoaded', renderHighscores);
    </script>
</body>
</html>
